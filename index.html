<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>HTML Minecraft 模拟器</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <style>
        /* 1. 全局和基础样式 */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #333; /* 页面背景 */
            font-family: 'Press Start 2P', cursive;
            color: white;
            /* 禁用默认选择和右键菜单 */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* 2. 游戏世界容器 */
        .world-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            /* 关键：保持像素的锐利感 */
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            cursor: crosshair; /* 游戏准星 */
        }

        /* 3. 天空和日夜循环 */
        .sky {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #87CEEB; /* 白天天空 */
            z-index: 1;
            /* 颜色过渡动画 */
            transition: background-color 2s linear;
        }

        /* 太阳和月亮 */
        .celestial-body {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            z-index: 2;
            /* 初始位置 (JS会更新) */
            top: 50%;
            left: -100px;
            /* 居中定位 */
            transform: translate(-50%, -50%);
            transition: transform 0.1s linear; /* 平滑移动 */
        }

        .sun {
            background-color: #FFD700;
            box-shadow: 0 0 30px #FFD700;
        }

        .moon {
            background-color: #F0F0F0;
            box-shadow: 0 0 20px #FFFFFF;
        }

        /* 4. 世界网格 (方块) */
        .world-grid {
            position: relative;
            z-index: 10;
            display: grid;
            /* JS将设置 grid-template-columns 和 rows */
        }

        .block {
            width: 40px;
            height: 40px;
            box-sizing: border-box; /* 边框包含在大小内 */
            /* 模拟方块边框 */
            border: 1px solid rgba(0, 0, 0, 0.2);
        }

        /* 方块类型 */
        .block.air {
            background: transparent;
            border: none;
        }

        .block.grass {
            background-color: #6A994E;
            border-bottom: 2px solid #5C3A21; /* 底部是泥土 */
        }

        .block.dirt {
            background-color: #7F5539;
            border-color: #5C3A21;
        }

        .block.stone {
            background-color: #808080;
            border-color: #606060;
        }
        
        .block.planks {
            background-color: #A68A64;
            border-color: #8C6D46;
        }

        /* 5. 夜间光照遮罩 */
        .night-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #00001E; /* 深蓝色 */
            opacity: 0; /* 白天透明 */
            z-index: 20; /* 在方块之上 */
            pointer-events: none; /* 穿透点击 */
            transition: opacity 2s linear;
        }
        
        /* 6. 底部快捷栏 (Hotbar) */
        .hotbar-container {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            background-color: rgba(0, 0, 0, 0.4);
            border: 2px solid #333;
            padding: 4px;
            z-index: 30; /* 在最上层 */
        }

        .hotbar-slot {
            width: 50px;
            height: 50px;
            background-color: #8B8B8B;
            border: 2px solid #373737;
            margin: 2px;
            box-shadow: inset 2px 2px 0px 0px #585858;
            position: relative;
            cursor: pointer;
            /* 继承方块样式 */
            box-sizing: border-box; 
        }
        
        .hotbar-slot.active::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border: 3px solid white;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div class="world-container">
        
        <div class="sky" id="sky">
            <div class="celestial-body sun" id="sun"></div>
            <div class="celestial-body moon" id="moon"></div>
        </div>
        
        <div class="world-grid" id="world-grid">
            </div>

        <div class="night-overlay" id="night-overlay"></div>

    </div>

    <div class="hotbar-container" id="hotbar">
        <div class="hotbar-slot block grass active" data-block-type="grass"></div>
        <div class="hotbar-slot block dirt" data-block-type="dirt"></div>
        <div class="hotbar-slot block stone" data-block-type="stone"></div>
        <div class="hotbar-slot block planks" data-block-type="planks"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- 1. 常量和状态 ---
            const BLOCK_SIZE = 40;
            const GRID_WIDTH = Math.ceil(window.innerWidth / BLOCK_SIZE);
            const GRID_HEIGHT = Math.ceil(window.innerHeight / BLOCK_SIZE);
            
            const worldGrid = document.getElementById('world-grid');
            const hotbar = document.getElementById('hotbar');
            const hotbarSlots = document.querySelectorAll('.hotbar-slot');
            
            const sky = document.getElementById('sky');
            const sun = document.getElementById('sun');
            const moon = document.getElementById('moon');
            const nightOverlay = document.getElementById('night-overlay');

            let selectedBlockType = 'grass'; // 默认选择草
            let gameTime = 0; // 游戏时间 (0-23999)
            const DAY_DURATION = 24000; // 游戏刻 (约 20 分钟, 这里我们加快)
            const TICK_SPEED = 20; // 游戏刻的毫秒 (越小越快, 50ms 约等于 20 分钟一天)

            // --- 2. 世界生成 ---
            function generateWorld() {
                console.log(`生成世界: ${GRID_WIDTH}x${GRID_HEIGHT}`);
                worldGrid.style.gridTemplateColumns = `repeat(${GRID_WIDTH}, ${BLOCK_SIZE}px)`;
                worldGrid.style.gridTemplateRows = `repeat(${GRID_HEIGHT}, ${BLOCK_SIZE}px)`;

                const groundLevel = Math.floor(GRID_HEIGHT * 0.6); // 地平线在 60% 的位置

                for (let y = 0; y < GRID_HEIGHT; y++) {
                    for (let x = 0; x < GRID_WIDTH; x++) {
                        const block = document.createElement('div');
                        let blockType = 'air';

                        if (y > groundLevel) {
                            if (y === groundLevel + 1) {
                                blockType = 'grass';
                            } else if (y < groundLevel + 5) {
                                blockType = 'dirt';
                            } else {
                                blockType = 'stone';
                            }
                        }
                        
                        block.className = `block ${blockType}`;
                        block.dataset.x = x;
                        block.dataset.y = y;
                        worldGrid.appendChild(block);
                    }
                }
            }

            // --- 3. 交互控制 ---
            function setupControls() {
                // A. 快捷栏点击
                hotbar.addEventListener('click', (e) => {
                    const clickedSlot = e.target.closest('.hotbar-slot');
                    if (clickedSlot) {
                        // 移除所有 active
                        hotbarSlots.forEach(slot => slot.classList.remove('active'));
                        // 添加 active
                        clickedSlot.classList.add('active');
                        // 更新选中状态
                        selectedBlockType = clickedSlot.dataset.blockType;
                    }
                });

                // B. 放置方块 (左键)
                worldGrid.addEventListener('click', (e) => {
                    if (e.target.classList.contains('block')) {
                        const block = e.target;
                        // 只能在空气中放置
                        if (block.classList.contains('air')) {
                            block.className = `block ${selectedBlockType}`;
                        }
                    }
                });

                // C. 破坏方块 (右键)
                worldGrid.addEventListener('contextmenu', (e) => {
                    e.preventDefault(); // 阻止右键菜单
                    if (e.target.classList.contains('block')) {
                        const block = e.target;
                        // 不能破坏空气
                        if (!block.classList.contains('air')) {
                            block.className = 'block air';
                        }
                    }
                });
            }

            // --- 4. 日夜循环 ---
            function gameLoop() {
                // A. 更新游戏时间
                gameTime = (gameTime + 1) % DAY_DURATION;
                
                // B. 更新天空、光照和天体
                updateCycle(gameTime);

                // C. 循环
                setTimeout(gameLoop, TICK_SPEED);
            }
            
            function updateCycle(time) {
                const cyclePercent = time / DAY_DURATION; // 0.0 - 1.0

                // B1. 天体位置 (太阳和月亮)
                // 使用三角函数计算圆形轨迹
                // -0.25 是为了让 0 点 (cyclePercent=0) 在东边 (x=1, y=0)
                const angle = (cyclePercent - 0.25) * 2 * Math.PI;
                const xPos = Math.cos(angle);
                const yPos = Math.sin(angle); // y 轴反转 (上方为负)

                // 太阳
                // 50vw 和 60vh 是轨道的半径
                sun.style.transform = `translate(calc(50vw + ${xPos * 60}vw - 50%), calc(50vh + ${yPos * 60}vh - 50%))`;
                
                // 月亮 (在太阳对面)
                const moonAngle = angle + Math.PI;
                const moonXPos = Math.cos(moonAngle);
                const moonYPos = Math.sin(moonAngle);
                moon.style.transform = `translate(calc(50vw + ${moonXPos * 60}vw - 50%), calc(50vh + ${moonYPos * 60}vh - 50%))`;
                

                // B2. 天空颜色和光照
                let skyColor = '#87CEEB'; // 白天
                let lightOpacity = 0; // 白天

                if (cyclePercent > 0.95 || cyclePercent < 0.05) { // 日出 (0.95 - 0.05)
                    skyColor = '#FF8C00'; // 橙色
                    lightOpacity = 0.3;
                } else if (cyclePercent > 0.45 && cyclePercent < 0.55) { // 日落 (0.45 - 0.55)
                    skyColor = '#FF4500'; // 橙红色
                    lightOpacity = 0.4;
                } else if (cyclePercent > 0.55 && cyclePercent < 0.95) { // 夜晚 (0.55 - 0.95)
                    skyColor = '#000033'; // 深蓝色
                    lightOpacity = 0.7;
                }
                
                sky.style.backgroundColor = skyColor;
                nightOverlay.style.opacity = lightOpacity;
            }

            // --- 5. 启动游戏 ---
            generateWorld();
            setupControls();
            gameLoop();
        });
    </script>

</body>
</html>
