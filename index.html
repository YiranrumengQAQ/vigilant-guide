<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minecraft 皮肤 3D 预览</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", "PingFang SC", sans-serif;
      background: radial-gradient(circle at top left, #1a1f2c, #0e0f14);
      color: #fff;
    }
    .container {
      max-width: 960px;
      margin: auto;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    .panel {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      backdrop-filter: blur(6px);
    }
    .btn {
      padding: 10px 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: linear-gradient(135deg, #6aa9ff, #9b6aff);
      color: #fff;
      font-weight: bold;
      margin-right: 10px;
    }
    .dropzone {
      border: 2px dashed #6aa9ff;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      margin-top: 10px;
      transition: background 0.3s;
    }
    .dropzone.dragover {
      background: rgba(106,169,255,0.2);
    }
    .controls {
      margin-top: 10px;
    }
    .controls label {
      margin-right: 15px;
    }
    .slider {
      margin-top: 10px;
    }
    canvas {
      width: 100%;
      height: 480px;
      display: block;
      background: #222;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Minecraft 皮肤 3D 预览</h1>
    <div class="panel">
      <button class="btn" id="chooseBtn">选择皮肤文件</button>
      <input type="file" id="fileInput" accept="image/png" style="display:none" />
      <div class="dropzone" id="dropzone">拖拽皮肤 PNG 到此处</div>
      <div class="controls">
        <label><input type="radio" name="arm" value="classic" checked> 粗手臂（Steve）</label>
        <label><input type="radio" name="arm" value="slim"> 细手臂（Alex）</label>
      </div>
      <div class="slider">
        缩放：<input type="range" id="zoomRange" min="0.8" max="2.0" step="0.01" value="1.2">
      </div>
      <div class="slider">
        旋转速度：<input type="range" id="spinRange" min="0" max="3" step="0.01" value="0.6">
      </div>
    </div>
    <div class="panel">
      <canvas id="skinCanvas"></canvas>
    </div>
  </div>

  <!-- Three.js + SkinView3D -->
  <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
  <script src="https://unpkg.com/skinview3d@3.0.0-beta.7/bundles/skinview3d.bundle.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const chooseBtn = document.getElementById("chooseBtn");
      const fileInput = document.getElementById("fileInput");
      const dropzone = document.getElementById("dropzone");
      const canvas = document.getElementById("skinCanvas");
      const zoomRange = document.getElementById("zoomRange");
      const spinRange = document.getElementById("spinRange");

      // 初始化 SkinViewer
      const viewer = new skinview3d.SkinViewer({
        canvas: canvas,
        width: canvas.clientWidth,
        height: canvas.clientHeight,
        alpha: true
      });
      const rotator = viewer.animations.add(skinview3d.createRotatorAnimation());
      rotator.speed = parseFloat(spinRange.value);

      // 点击按钮触发文件选择
      chooseBtn.addEventListener("click", () => {
        fileInput.click();
      });

      // 文件选择后加载皮肤
      fileInput.addEventListener("change", e => {
        const file = e.target.files[0];
        if (file) loadSkinFile(file);
      });

      // 拖拽导入
      ["dragenter", "dragover"].forEach(evt => {
        dropzone.addEventListener(evt, e => {
          e.preventDefault();
          e.stopPropagation();
          dropzone.classList.add("dragover");
        });
      });
      ["dragleave", "drop"].forEach(evt => {
        dropzone.addEventListener(evt, e => {
          e.preventDefault();
          e.stopPropagation();
          dropzone.classList.remove("dragover");
        });
      });
      dropzone.addEventListener("drop", e => {
        const file = e.dataTransfer.files[0];
        if (file) loadSkinFile(file);
      });

      // 加载皮肤函数
      function loadSkinFile(file) {
        if (file.type !== "image/png") {
          alert("仅支持 PNG 文件");
          return;
        }
        const url = URL.createObjectURL(file);
        const armType = document.querySelector('input[name="arm"]:checked').value;
        viewer.playerObject.skin.setModel(
          armType === "slim" ? skinview3d.ModelType.SLIM : skinview3d.ModelType.CLASSIC
        );
        viewer.loadSkin(url);
      }

      // 缩放控制
      zoomRange.addEventListener("input", () => {
        viewer.zoom = parseFloat(zoomRange.value);
      });

      // 旋转速度控制
      spinRange.addEventListener("input", () => {
        rotator.speed = parseFloat(spinRange.value);
      });
    });
  </script>
</body>
</html>
