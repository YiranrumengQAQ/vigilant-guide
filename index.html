<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>宁静山谷 · 心灵休憩处</title>
    <style>
        /* ====================== 全局美学 ====================== */
        * { margin:0; padding:0; box-sizing:border-box; }
        body, html { height:100%; overflow:hidden; font-family:"Segoe UI", "Microsoft YaHei", sans-serif; }
        
        /* 精美风景背景（渐变 + 模糊层 + 动态云） */
        #bg {
            position:fixed; top:0; left:0; width:100%; height:100%; z-index:-3;
            background:linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            filter:blur(1px);
        }
        #clouds {
            position:fixed; top:0; left:0; width:100%; height:100%; z-index:-2;
            background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 600"><defs><radialGradient id="c"><stop offset="0%" stop-color="%23fff"/><stop offset="100%" stop-color="%23fff" stop-opacity="0"/></radialGradient></defs><ellipse cx="200" cy="150" rx="180" ry="60" fill="url(%23c)" opacity="0.6"/><ellipse cx="800" cy="120" rx="220" ry="80" fill="url(%23c)" opacity="0.5"/><ellipse cx="500" cy="180" rx="160" ry="50" fill="url(%23c)" opacity="0.7"/></svg>') repeat-x;
            background-size:400px 200px;
            animation:cloud 180s linear infinite;
        }
        @keyframes cloud { 0%{background-position:0 0;} 100%{background-position:2000px 0;} }

        /* 山体剪影 */
        #mountains {
            position:fixed; bottom:0; left:0; width:100%; height:50%; z-index:-1;
            background:linear-gradient(to top, #6ee7b7 0%, #34d399 100%);
            clip-path:polygon(0 100%, 0 60%, 10% 55%, 20% 65%, 30% 50%, 40% 60%, 50% 45%, 60% 55%, 70% 50%, 80% 60%, 90% 55%, 100% 65%, 100% 100%);
        }

        /* 湖面倒影 */
        #lake {
            position:fixed; bottom:0; left:0; width:100%; height:30%; z-index:0;
            background:linear-gradient(to bottom, rgba(255,255,255,0.1), rgba(255,255,255,0.3));
            backdrop-filter:blur(8px);
            animation:ripple 12s ease-in-out infinite;
        }
        @keyframes ripple {
            0%,100%{ transform:scaleY(1); }
            50%{ transform:scaleY(1.03); }
        }

        /* 隐藏触发区（整页点击20次） */
        #trigger-area { position:fixed; inset:0; cursor:default; }

        /* 右下角不明显“石头” */
        #stone {
            position:fixed; right:15px; bottom:15px; width:28px; height:28px; z-index:5;
            background:radial-gradient(circle at 30% 30%, #aaa 0%, #777 70%, #555 100%);
            border-radius:50%; box-shadow:0 2px 6px rgba(0,0,0,0.3);
            opacity:0.22; transition:opacity .4s;
            cursor:pointer;
        }
        #stone:hover { opacity:0.45; }

        /* ====================== OMEGA 面板（隐藏） ====================== */
        #omega-panel {
            position:fixed; inset:0; background:rgba(20,10,30,0.96); color:#fff;
            display:none; flex-direction:column; align-items:center; justify-content:flex-start;
            padding-top:2vh; backdrop-filter:blur(12px); z-index:999;
            font-size:1rem; line-height:1.6; overflow-y:auto;
        }
        #omega-header {
            width:90%; max-width:680px; text-align:center; margin-bottom:1rem;
            font-size:1.8rem; font-weight:300; letter-spacing:1px;
            color:#ff99cc; text-shadow:0 0 8px #ff66aa;
        }
        .heart { color:#ff69b4; animation:pulse 1.8s infinite; }
        @keyframes pulse { 0%,100%{transform:scale(1);} 50%{transform:scale(1.2);} }

        .input-group { margin:12px 0; width:90%; max-width:480px; }
        label { display:block; margin-bottom:4px; color:#ffccdd; font-weight:500; }
        input[type=number] {
            width:100%; padding:10px 14px; border:none; border-radius:8px;
            background:#ffffff22; color:#fff; font-size:1rem;
            backdrop-filter:blur(4px);
        }
        input[type=number]:focus { outline:2px solid #ff69b4; }

        #status-bar { margin:16px 0; width:90%; max-width:480px; text-align:center; color:#a0f7c0; }
        #log { width:90%; max-width:680px; min-height:180px; background:#111118; border-radius:8px; padding:12px; overflow-y:auto; font-family:monospace; color:#ffeb3b; }

        button {
            margin-top:12px; padding:10px 24px; border:none; border-radius:8px;
            background:#ff69b4; color:#fff; font-weight:600; cursor:pointer;
            box-shadow:0 4px 12px rgba(255,105,180,0.4);
            transition:transform .2s, box-shadow .2s;
        }
        button:hover { transform:translateY(-2px); box-shadow:0 6px 16px rgba(255,105,180,0.6); }

        .hidden { display:none; }
    </style>
</head>
<body>

    <!-- 背景层 -->
    <div id="bg"></div>
    <div id="clouds"></div>
    <div id="mountains"></div>
    <div id="lake"></div>

    <!-- 隐藏触发区：点击20次 -->
    <div id="trigger-area"></div>

    <!-- 右下角石头（点10次） -->
    <div id="stone" title="??"></div>

    <!-- ====================== OMEGA 控制面板 ====================== -->
    <div id="omega-panel">
        <div id="omega-header">
            <span class="heart">♥</span> L O V E L Y  P L E A S U R E  L O O P <span class="heart">♥</span> V3.0
        </div>

        <div class="input-group">
            <label>玩具插入长度 (cm，≤150.0)</label>
            <input type="number" id="toy-length" step="0.1" min="0" max="150" placeholder="例如 12.5">
        </div>
        <div class="input-group">
            <label>玩具最大直径 (cm，≤5.0)</label>
            <input type="number" id="toy-diameter" step="0.1" min="0" max="5" placeholder="例如 3.2">
        </div>
        <div class="input-group">
            <label>总动作次数（默认10，自动取偶数）</label>
            <input type="number" id="total-count" min="2" placeholder="留空使用默认">
        </div>

        <button id="start-btn">开始温柔会话</button>

        <div id="status-bar"></div>
        <pre id="log"></pre>
    </div>

<script>
/* ====================== 触发逻辑 ====================== */
let pageClicks = 0;
let stoneClicks = 0;
const PAGE_THRESHOLD = 20;
const STONE_THRESHOLD = 10;

document.getElementById('trigger-area').addEventListener('click', () => {
    pageClicks++;
    if (pageClicks >= PAGE_THRESHOLD) {
        document.getElementById('stone').style.opacity = '0.6';
        pageClicks = 0; // 重置防止重复触发
    }
});

document.getElementById('stone').addEventListener('click', (e) => {
    e.stopPropagation();
    stoneClicks++;
    if (stoneClicks >= STONE_THRESHOLD) {
        document.getElementById('omega-panel').style.display = 'flex';
        stoneClicks = 0;
        initOmega();
    }
});

/* ====================== OMEGA 核心逻辑 ====================== */
let intervalId = null;
let cycleCount = 0;
let totalInsertions = 0;
let sessionStart = 0;

const MAX_DEPTH = 150.0;
const MAX_DIAMETER = 5.0;
const DEFAULT_COUNT = 10;

function log(msg) {
    const logEl = document.getElementById('log');
    logEl.textContent += msg + '\n';
    logEl.scrollTop = logEl.scrollHeight;
}

function initOmega() {
    const startBtn = document.getElementById('start-btn');
    startBtn.onclick = startSession;
}

function startSession() {
    // 读取并校验输入
    const len = parseFloat(document.getElementById('toy-length').value) || 0;
    const dia = parseFloat(document.getElementById('toy-diameter').value) || 0;
    let count = parseInt(document.getElementById('total-count').value) || DEFAULT_COUNT;

    if (len <= 0 || len > MAX_DEPTH) { alert(`长度必须在 0~${MAX_DEPTH} cm`); return; }
    if (dia <= 0 || dia > MAX_DIAMETER) { alert(`直径必须在 0~${MAX_DIAMETER} cm`); return; }
    if (count < 2) count = DEFAULT_COUNT;
    if (count % 2 !== 0) { count++; log(`⚠️ 次数已自动调整为偶数：${count}`); }

    // 计算慢速频率
    const delaySec = (len / 50) + (dia / 5) + 0.5;
    const delayMs = Math.round(delaySec * 1000);

    // 初始化状态
    cycleCount = 0;
    totalInsertions = 0;
    sessionStart = Date.now();
    document.getElementById('log').textContent = '';
    log(`♥ 玩具：${len}cm × ${dia}cm`);
    log(`♥ 频率：${delaySec.toFixed(3)} 秒/动作（更慢更温柔）`);
    log(`♥ 总动作：${count} 次（目标插入 ${count/2} 次）`);
    log(`------------------------------------------------`);

    // 禁用按钮
    const btn = document.getElementById('start-btn');
    btn.disabled = true;
    btn.textContent = '会话进行中…';

    // 主循环
    intervalId = setInterval(() => {
        cycleCount++;
        const isInsert = cycleCount % 2 === 1;

        if (isInsert) {
            totalInsertions++;
            log(`[${cycleCount}/${count}] ♥ > > >  ${len}cm 完全插入！ (第 ${totalInsertions} 次) 温柔快感…`);
        } else {
            log(`[${cycleCount}/${count}] ♥ < < <  ${len}cm 完全拔出。 期待下一次…`);
        }

        updateStatus(delaySec, count);

        if (cycleCount >= count) {
            clearInterval(intervalId);
            sessionEnd();
        }
    }, delayMs);
}

function updateStatus(delay, total) {
    const elapsed = Math.floor((Date.now() - sessionStart) / 1000);
    const h = String(Math.floor(elapsed/3600)).padStart(2,'0');
    const m = String(Math.floor((elapsed/60)%60)).padStart(2,'0');
    const s = String(elapsed%60).padStart(2,'0');

    document.getElementById('status-bar').innerHTML = `
        ⏱ ${h}:${m}:${s} | 
        进度 ${cycleCount}/${total} | 
        插入 ${totalInsertions} 次 | 
        频率 ${delay.toFixed(2)}s/次
    `;
}

function sessionEnd() {
    const duration = Math.floor((Date.now() - sessionStart) / 1000);
    const h = String(Math.floor(duration/3600)).padStart(2,'0');
    const m = String(Math.floor((duration/60)%60)).padStart(2,'0');
    const s = String(duration%60).padStart(2,'0');

    log(`\n♥♥♥ 会话结束！${totalInsertions} 次温柔插入完成 ♥♥♥`);
    log(`总时长：${h}:${m}:${s}`);
    
    const btn = document.getElementById('start-btn');
    btn.disabled = false;
    btn.textContent = '再次开始';
}
</script>
</body>
</html>
